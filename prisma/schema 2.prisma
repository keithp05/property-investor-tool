// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  password      String
  role          UserRole  @default(INVESTOR)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  properties    Property[]
  tenants       Tenant[]
  maintenanceRequests MaintenanceRequest[]
  leases        Lease[]
}

enum UserRole {
  INVESTOR
  TENANT
  ADMIN
}

model Property {
  id                String      @id @default(cuid())
  address           String
  city              String
  state             String
  zipCode           String
  latitude          Float?
  longitude         Float?

  // Property Details
  propertyType      PropertyType
  bedrooms          Int
  bathrooms         Float
  squareFeet        Int?
  lotSize           Float?
  yearBuilt         Int?

  // Financial
  purchasePrice     Float?
  currentValue      Float?
  monthlyRent       Float?
  estimatedRent     Float?

  // Status
  status            PropertyStatus @default(SEARCHING)

  // Source
  source            String?       // zillow, realtor, facebook
  externalId        String?       // ID from external source
  sourceUrl         String?

  // Media
  images            String?       // JSON string of image URLs

  // Analytics
  cmaData           Json?         // Comparative Market Analysis
  crimeData         Json?         // Crime statistics
  demographics      Json?         // Area demographics

  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  owner             User          @relation(fields: [ownerId], references: [id])
  ownerId           String

  leases            Lease[]
  maintenanceRequests MaintenanceRequest[]
  bills             Bill[]
  payments          Payment[]

  @@index([city, state])
  @@index([status])
  @@index([ownerId])
}

enum PropertyType {
  SINGLE_FAMILY
  MULTI_FAMILY
  CONDO
  TOWNHOUSE
  APARTMENT
  COMMERCIAL
}

enum PropertyStatus {
  SEARCHING
  ANALYZING
  UNDER_CONTRACT
  OWNED
  RENTED
  FOR_SALE
}

model Tenant {
  id                String      @id @default(cuid())
  firstName         String
  lastName          String
  email             String      @unique
  phone             String?

  // Screening
  creditScore       Int?
  annualIncome      Float?
  employmentStatus  String?
  backgroundCheck   Json?

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  landlord          User        @relation(fields: [landlordId], references: [id])
  landlordId        String

  leases            Lease[]
  maintenanceRequests MaintenanceRequest[]
  bills             Bill[]
  payments          Payment[]

  @@index([landlordId])
}

model Lease {
  id                String      @id @default(cuid())

  startDate         DateTime
  endDate           DateTime
  monthlyRent       Float
  securityDeposit   Float

  status            LeaseStatus @default(ACTIVE)
  documentUrl       String?     // Generated lease PDF

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  property          Property    @relation(fields: [propertyId], references: [id])
  propertyId        String

  tenant            Tenant      @relation(fields: [tenantId], references: [id])
  tenantId          String

  landlord          User        @relation(fields: [landlordId], references: [id])
  landlordId        String

  bills             Bill[]
  payments          Payment[]

  @@index([propertyId])
  @@index([tenantId])
  @@index([landlordId])
}

model Bill {
  id                String      @id @default(cuid())

  // Bill Details
  name              String      // "Rent", "Water", "Electricity", "HOA", "Lawn Care", etc.
  description       String?
  amount            Float

  // Billing Schedule
  billType          BillType    @default(CUSTOM)
  isRecurring       Boolean     @default(false)
  frequency         BillFrequency? // MONTHLY, QUARTERLY, ANNUALLY, etc.
  dueDay            Int?        // Day of month (1-31) for recurring bills

  // Due Date
  dueDate           DateTime

  // Status
  status            BillStatus  @default(PENDING)
  paidDate          DateTime?
  paidAmount        Float?

  // Late Fees
  lateFeeEnabled    Boolean     @default(false)
  lateFeeAmount     Float?
  lateFeeAppliedDate DateTime?

  // Notes
  notes             String?

  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt

  lease             Lease       @relation(fields: [leaseId], references: [id], onDelete: Cascade)
  leaseId           String

  tenant            Tenant      @relation(fields: [tenantId], references: [id])
  tenantId          String

  property          Property    @relation(fields: [propertyId], references: [id])
  propertyId        String

  payments          Payment[]

  @@index([leaseId])
  @@index([tenantId])
  @@index([propertyId])
  @@index([dueDate])
  @@index([status])
}

enum BillType {
  RENT
  WATER
  ELECTRICITY
  GAS
  INTERNET
  CABLE
  TRASH
  SEWER
  HOA
  LAWN_CARE
  PEST_CONTROL
  PARKING
  PET_RENT
  STORAGE
  LATE_FEE
  CUSTOM
}

enum BillFrequency {
  WEEKLY
  BIWEEKLY
  MONTHLY
  QUARTERLY
  SEMI_ANNUALLY
  ANNUALLY
  ONE_TIME
}

enum BillStatus {
  PENDING
  PAID
  PARTIAL
  OVERDUE
  WAIVED
  CANCELLED
}

model Payment {
  id                String        @id @default(cuid())

  amount            Float
  paymentDate       DateTime      @default(now())
  paymentMethod     PaymentMethod @default(OTHER)

  // Payment Details
  confirmationNumber String?
  notes             String?

  // Associated Bill (optional - can be a general payment)
  bill              Bill?         @relation(fields: [billId], references: [id])
  billId            String?

  lease             Lease         @relation(fields: [leaseId], references: [id], onDelete: Cascade)
  leaseId           String

  tenant            Tenant        @relation(fields: [tenantId], references: [id])
  tenantId          String

  property          Property      @relation(fields: [propertyId], references: [id])
  propertyId        String

  createdAt         DateTime      @default(now())
  updatedAt         DateTime      @updatedAt

  @@index([leaseId])
  @@index([tenantId])
  @@index([propertyId])
  @@index([billId])
  @@index([paymentDate])
}

enum PaymentMethod {
  CASH
  CHECK
  BANK_TRANSFER
  CREDIT_CARD
  DEBIT_CARD
  VENMO
  ZELLE
  PAYPAL
  CASHAPP
  OTHER
}

enum LeaseStatus {
  DRAFT
  ACTIVE
  EXPIRED
  TERMINATED
}

model MaintenanceRequest {
  id                String              @id @default(cuid())
  title             String
  description       String
  priority          Priority            @default(MEDIUM)
  status            MaintenanceStatus   @default(OPEN)

  images            String?             // JSON string of image URLs

  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  completedAt       DateTime?

  property          Property            @relation(fields: [propertyId], references: [id])
  propertyId        String

  tenant            Tenant?             @relation(fields: [tenantId], references: [id])
  tenantId          String?

  assignedTo        User                @relation(fields: [assignedToId], references: [id])
  assignedToId      String

  @@index([propertyId])
  @@index([status])
  @@index([assignedToId])
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum MaintenanceStatus {
  OPEN
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model CMAReport {
  id                String      @id @default(cuid())
  propertyAddress   String

  // Comparable properties
  comparables       Json

  // AI Analysis
  estimatedValue    Float
  confidence        Float
  marketTrends      Json
  recommendations   String

  createdAt         DateTime    @default(now())

  @@index([propertyAddress])
}

model CrimeReport {
  id                String      @id @default(cuid())
  address           String
  latitude          Float
  longitude         Float

  // Crime statistics
  crimeScore        Float
  incidents         Json
  trends            Json

  createdAt         DateTime    @default(now())

  @@index([latitude, longitude])
}
